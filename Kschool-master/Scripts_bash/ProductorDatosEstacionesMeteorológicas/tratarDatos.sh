#!/bin/bash

capitales=(51537 112931 146268 160196 167541 184745 223816 232422 250441 276781 285787 287286 290030 290340 292968 323786 343300 360630 365618 425374 444178 524901 588409 616912 618069 625144 658226 676742 703448 727011 785842 786714 890299 908248 909137 921772 921772 932505 933773 934154 934985 964137 975511 1040652 1070940 1138958 1176615 1230089 1252416 1273840 1282027 1283678 1298987 1298987 1348591 1484839 1526273 1528334 1561096 1619460 1630798 1631845 1645457 1659203 1668341 1699806 1701668 1735106 1735161 1816670 1820906 1843564 1846735 2028462 2075807 2081918 2108502 2110257 2110384 2113779 2135171 2161311 2172517 2198148 2207349 2210247 2220957 2240449 2253354 2260535 2279755 2306104 2312096 2352778 2365266 2374776 2377450 2389853 2392087 2395635 2399697 2408770 2410758 2413876 2422488 2427123 2460596 2472818 2538474 2562955 2595294 2673722 2759794 2800865 2960316 2962486 2988507 2988507 2993458 3028258 3054643 3060972 3065330 3094325 3164670 3183875 3186886 3191281 3193044 3196359 3374333 3383330 3416900 3441575 3469058 3474570 3575551 3575551 3575635 3579926 3583361 3598132 3600949 3617763 3621841 3646738 3652462 3678415 3689793 3703433 3718426 3739034 3846616 3903987 3936456 3983689 4032402 4140963 4215307 4292686 4516749 4562695 4713813 4792273 4905006 5138935 5374175 6138517 6290252 6361450 6413338 6453366 6559994 6930704 7259612 7285212 7303944 7498240 7498240 7701342)

while :
do
# bucle que envia las peticiones
for i in "${capitales[@]}"
do

# P recoge el json que se recupera de curl -X GET ....y $i es el id de las capitales
P=`curl -X GET -H "Content-type: application/json" -H "Accept: application/json"  "http://api.openweathermap.org/data/2.5/weather?id=$i&APPID=9398ed1aa953fe02d3725e32f2ccaa6a" 2>/dev/null  | jq  '{lon: .coord.lon,lat: .coord.lat,temp_max: .main.temp_max,temp_min: .main.temp_min,temp: .main.temp,pressure: .main.pressure,humidity: .main.humidity,id: .id,datetime: .dt}'`
 echo $P
 curl -X POST  -H "Content-type: application/json" -d "$P" "http://LBkafkaPixyDosInstancias-397601491.us-east-1.elb.amazonaws.com:80/topics/datos/messages?key=$i"

   echo "end"
   sleep 1
done



done
